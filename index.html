<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Melbourne Housing & Commute Explorer</title>

  <!-- Data table -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/simple-datatables@latest/dist/style.css">
  <script src="https://cdn.jsdelivr.net/npm/simple-datatables@latest"></script>

  <!-- Chart -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    body {
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      margin: 24px;
    }
    .wrap {
      max-width: 1100px;
    }
    h1 {
      margin: 0 0 8px 0;
      font-size: 24px;
    }
    h2 {
      margin-top: 32px;
      font-size: 18px;
    }
    p {
      margin: 0 0 16px 0;
      line-height: 1.4;
    }
    .meta {
      font-size: 14px;
      opacity: 0.85;
    }
    table {
      width: 100%;
      margin-top: 24px;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Melbourne Housing & Commute Explorer</h1>
    <p class="meta">
      Sort and search suburbs by commute time and distance.
    </p>

    <h2>PT Commute Time vs CBD Distance (0–60 min)</h2>
    <canvas id="ptChart" width="900" height="400"></canvas>

    <table id="housingTable">
      <thead>
        <tr>
          <th>Suburb</th>
          <th>CBD Distance (km)</th>
          <th>PT Commute (min)</th>
          <th>Car Commute (min)</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

<script>
fetch("./melbourne_housing_data.json")
  .then(res => res.json())
  .then(rows => {

    // Populate table
    const tbody = document.querySelector("#housingTable tbody");
    for (const r of rows) {
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${r.suburb ?? ""}</td>
        <td>${r.cbd_dist_km ?? ""}</td>
        <td>${r.pt_commute_min ?? ""}</td>
        <td>${r.car_commute_min ?? ""}</td>
      `;
      tbody.appendChild(tr);
    }

    new simpleDatatables.DataTable("#housingTable", {
      searchable: true,
      fixedHeight: true,
      perPage: 25,
      perPageSelect: [10, 25, 50, 100]
    });

    // Prepare chart data (PT commute 0–60 min)
    const chartData = rows
      .filter(r =>
        r.pt_commute_min !== null &&
        r.pt_commute_min >= 0 &&
        r.pt_commute_min <= 60
      )
      .map(r => ({
        x: r.pt_commute_min,
        y: r.cbd_dist_km,
        suburb: r.suburb
      }));

    const ctx = document.getElementById("ptChart");

    new Chart(ctx, {
      type: "scatter",
      data: {
        datasets: [{
          data: chartData,
          pointRadius: 4,
          pointHoverRadius: 7
        }]
      },
      options: {
        scales: {
          x: {
            min: 0,
            max: 60,
            title: {
              display: true,
              text: "PT Commute Time (minutes)"
            }
          },
          y: {
            title: {
              display: true,
              text: "CBD Distance (km)"
            }
          }
        },
        plugins: {
          legend: {
            display: false
          },
          tooltip: {
            callbacks: {
              label: function(ctx) {
                const d = ctx.raw;
                return `${d.suburb}: ${d.x} min, ${d.y} km`;
              }
            }
          }
        }
      }
    });
  });
</script>
</body>
</html>
